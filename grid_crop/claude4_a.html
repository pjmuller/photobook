<!--Great, the cropping and zooming works. however
* the gutters don't show well nor resize the cells, see grid/00_gemini_2.5.html code for a working version of the gutters (though without image cropping)
* you don't respect the 35:29 aspect ratio of the full page, currently it's 100% height and 100% width
* I don't need the fit or center option, I only want the fill flow. So simplify the UI (basically only need a slider for zoom)
* Make sure we never show whitespace currently I can move the image too freely  -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Album Layout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #2c2c2c;
            font-family: Arial, sans-serif;
        }

        .album-container {
            width: 100%;
            height: calc(100vh - 40px);
            display: flex;
            background: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        .page {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            position: relative;
        }

        .page-left {
            border-right: 2px solid #dee2e6;
        }

        .row-container {
            flex: 1;
            display: flex;
            min-height: 0;
        }

        .cell {
            flex: 1;
            background: #fff;
            border: 1px solid #dee2e6;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            min-width: 0;
            min-height: 0;
        }

        .cell:hover {
            box-shadow: inset 0 0 0 2px #007bff;
        }

        .cell.active {
            box-shadow: inset 0 0 0 3px #007bff;
        }

        .image-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            background: #f8f9fa;
        }

        .image-container img {
            position: absolute;
            cursor: move;
            transition: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .gutter {
            background: #dee2e6;
            background-repeat: no-repeat;
            background-position: 50%;
        }

        .gutter.gutter-horizontal {
            cursor: row-resize;
            height: 4px;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+YMAzYwKioKGzZswAZOnDiBDRw9ehQWYAAAZogH9VQF+QgAAAAASUVORK5CYII=');
        }

        .gutter.gutter-vertical {
            cursor: col-resize;
            width: 4px;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFCAYAAABmBFJHAAAABklEQVQIHWPY+P8/AzYwKjgKGxYtWoQNHDx4EBs4fvw4LMAAVRMVFaUvdC0AAAAASUVORK5CYII=');
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            color: white;
            display: none;
            z-index: 1000;
            min-width: 200px;
        }

        .controls.show {
            display: block;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            color: #ccc;
        }

        .zoom-slider {
            width: 100%;
            margin: 5px 0;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #6c757d;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="album-container">
        <!-- Left Page -->
        <div class="page page-left" id="leftPage">
            <div class="row-container" id="leftRow1">
                <div class="cell" data-page="left" data-row="1" data-col="1">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="left" data-row="1" data-col="2">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="left" data-row="1" data-col="3">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
            </div>
            <div class="row-container" id="leftRow2">
                <div class="cell" data-page="left" data-row="2" data-col="1">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="left" data-row="2" data-col="2">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="left" data-row="2" data-col="3">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Page -->
        <div class="page" id="rightPage">
            <div class="row-container" id="rightRow1">
                <div class="cell" data-page="right" data-row="1" data-col="1">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="right" data-row="1" data-col="2">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="right" data-row="1" data-col="3">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
            </div>
            <div class="row-container" id="rightRow2">
                <div class="cell" data-page="right" data-row="2" data-col="1">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="right" data-row="2" data-col="2">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
                <div class="cell" data-page="right" data-row="2" data-col="3">
                    <div class="image-container">
                        <div class="loading-indicator">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls Panel -->
    <div class="controls" id="controls">
        <div class="control-group">
            <label>Zoom Level</label>
            <input type="range" class="zoom-slider" id="zoomSlider" min="100" max="500" value="100">
            <small id="zoomValue">100%</small>
        </div>
        <div class="control-group">
            <label>Quick Actions</label>
            <div class="btn-group">
                <button class="btn btn-primary btn-sm" id="fitBtn">Fit</button>
                <button class="btn btn-secondary btn-sm" id="fillBtn">Fill</button>
                <button class="btn btn-success btn-sm" id="centerBtn">Center</button>
            </div>
        </div>
        <div class="control-group">
            <button class="btn btn-warning btn-sm w-100" id="newImageBtn">New Image</button>
        </div>
    </div>

    <script>
        class PhotoAlbum {
            constructor() {
                this.activeCell = null;
                this.currentImageData = new Map();
                this.isDragging = false;
                this.dragStart = { x: 0, y: 0 };
                this.imageStart = { x: 0, y: 0 };
                
                this.init();
            }

            init() {
                this.setupSplitters();
                this.loadImages();
                this.setupEventListeners();
            }

            setupSplitters() {
                // Horizontal splitters (between rows)
                Split(['#leftRow1', '#leftRow2'], {
                    direction: 'vertical',
                    sizes: [50, 50],
                    gutterSize: 4,
                    minSize: 100
                });

                Split(['#rightRow1', '#rightRow2'], {
                    direction: 'vertical',
                    sizes: [50, 50],
                    gutterSize: 4,
                    minSize: 100
                });

                // Vertical splitters (between columns) for each row
                setTimeout(() => {
                    const rows = ['leftRow1', 'leftRow2', 'rightRow1', 'rightRow2'];
                    rows.forEach(rowId => {
                        const row = document.getElementById(rowId);
                        const cells = Array.from(row.children).filter(child => child.classList.contains('cell'));
                        if (cells.length === 3) {
                            Split(cells, {
                                direction: 'horizontal',
                                sizes: [33.33, 33.33, 33.33],
                                gutterSize: 4,
                                minSize: 50
                            });
                        }
                    });
                }, 100);
            }

            loadImages() {
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, index) => {
                    this.loadImageForCell(cell, index + 1);
                });
            }

            loadImageForCell(cell, imageId) {
                const container = cell.querySelector('.image-container');
                const loadingIndicator = container.querySelector('.loading-indicator');
                
                // Generate unique image URL
                const imageUrl = `https://picsum.photos/800/600?random=${imageId}&t=${Date.now()}`;
                
                const img = new Image();
                img.onload = () => {
                    if (loadingIndicator) {
                        loadingIndicator.remove();
                    }
                    
                    img.style.position = 'absolute';
                    img.style.cursor = 'move';
                    container.appendChild(img);
                    
                    // Initialize image data
                    this.currentImageData.set(cell, {
                        img: img,
                        scale: 1,
                        x: 0,
                        y: 0,
                        naturalWidth: img.naturalWidth,
                        naturalHeight: img.naturalHeight
                    });
                    
                    this.fitImageToCell(cell);
                };
                
                img.onerror = () => {
                    if (loadingIndicator) {
                        loadingIndicator.textContent = 'Failed to load';
                    }
                };
                
                img.src = imageUrl;
            }

            fitImageToCell(cell) {
                const data = this.currentImageData.get(cell);
                if (!data) return;
                
                const container = cell.querySelector('.image-container');
                const containerRect = container.getBoundingClientRect();
                
                // Calculate scale to fit
                const scaleX = containerRect.width / data.naturalWidth;
                const scaleY = containerRect.height / data.naturalHeight;
                const scale = Math.min(scaleX, scaleY);
                
                data.scale = scale;
                data.x = (containerRect.width - data.naturalWidth * scale) / 2;
                data.y = (containerRect.height - data.naturalHeight * scale) / 2;
                
                this.updateImageTransform(cell);
            }

            fillImageToCell(cell) {
                const data = this.currentImageData.get(cell);
                if (!data) return;
                
                const container = cell.querySelector('.image-container');
                const containerRect = container.getBoundingClientRect();
                
                // Calculate scale to fill
                const scaleX = containerRect.width / data.naturalWidth;
                const scaleY = containerRect.height / data.naturalHeight;
                const scale = Math.max(scaleX, scaleY);
                
                data.scale = scale;
                data.x = (containerRect.width - data.naturalWidth * scale) / 2;
                data.y = (containerRect.height - data.naturalHeight * scale) / 2;
                
                this.updateImageTransform(cell);
            }

            centerImage(cell) {
                const data = this.currentImageData.get(cell);
                if (!data) return;
                
                const container = cell.querySelector('.image-container');
                const containerRect = container.getBoundingClientRect();
                
                data.x = (containerRect.width - data.naturalWidth * data.scale) / 2;
                data.y = (containerRect.height - data.naturalHeight * data.scale) / 2;
                
                this.updateImageTransform(cell);
            }

            updateImageTransform(cell) {
                const data = this.currentImageData.get(cell);
                if (!data) return;
                
                const { img, scale, x, y } = data;
                img.style.width = `${data.naturalWidth * scale}px`;
                img.style.height = `${data.naturalHeight * scale}px`;
                img.style.left = `${x}px`;
                img.style.top = `${y}px`;
            }

            setActiveCell(cell) {
                // Remove active class from all cells
                document.querySelectorAll('.cell').forEach(c => c.classList.remove('active'));
                
                this.activeCell = cell;
                if (cell) {
                    cell.classList.add('active');
                    this.showControls();
                    this.updateControlsForCell(cell);
                } else {
                    this.hideControls();
                }
            }

            showControls() {
                document.getElementById('controls').classList.add('show');
            }

            hideControls() {
                document.getElementById('controls').classList.remove('show');
            }

            updateControlsForCell(cell) {
                const data = this.currentImageData.get(cell);
                if (!data) return;
                
                const zoomSlider = document.getElementById('zoomSlider');
                const zoomValue = document.getElementById('zoomValue');
                
                const zoomPercent = Math.round(data.scale * 100);
                zoomSlider.value = zoomPercent;
                zoomValue.textContent = `${zoomPercent}%`;
            }

            setupEventListeners() {
                // Cell click handlers
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.setActiveCell(cell);
                    });
                });

                // Image drag handlers
                document.addEventListener('mousedown', (e) => {
                    if (e.target.tagName === 'IMG' && this.activeCell) {
                        e.preventDefault();
                        this.isDragging = true;
                        this.dragStart = { x: e.clientX, y: e.clientY };
                        
                        const data = this.currentImageData.get(this.activeCell);
                        if (data) {
                            this.imageStart = { x: data.x, y: data.y };
                        }
                    }
                });

                document.addEventListener('mousemove', (e) => {
                    if (this.isDragging && this.activeCell) {
                        e.preventDefault();
                        const data = this.currentImageData.get(this.activeCell);
                        if (data) {
                            const deltaX = e.clientX - this.dragStart.x;
                            const deltaY = e.clientY - this.dragStart.y;
                            
                            data.x = this.imageStart.x + deltaX;
                            data.y = this.imageStart.y + deltaY;
                            
                            this.updateImageTransform(this.activeCell);
                        }
                    }
                });

                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                });

                // Click outside to deselect
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.cell') && !e.target.closest('.controls')) {
                        this.setActiveCell(null);
                    }
                });

                // Zoom slider
                document.getElementById('zoomSlider').addEventListener('input', (e) => {
                    if (this.activeCell) {
                        const data = this.currentImageData.get(this.activeCell);
                        if (data) {
                            const container = this.activeCell.querySelector('.image-container');
                            const containerRect = container.getBoundingClientRect();
                            
                            // Calculate new scale
                            const newScale = parseInt(e.target.value) / 100;
                            
                            // Adjust position to zoom towards center
                            const centerX = containerRect.width / 2;
                            const centerY = containerRect.height / 2;
                            
                            const scaleRatio = newScale / data.scale;
                            data.x = centerX - (centerX - data.x) * scaleRatio;
                            data.y = centerY - (centerY - data.y) * scaleRatio;
                            data.scale = newScale;
                            
                            this.updateImageTransform(this.activeCell);
                            document.getElementById('zoomValue').textContent = `${e.target.value}%`;
                        }
                    }
                });

                // Control buttons
                document.getElementById('fitBtn').addEventListener('click', () => {
                    if (this.activeCell) {
                        this.fitImageToCell(this.activeCell);
                        this.updateControlsForCell(this.activeCell);
                    }
                });

                document.getElementById('fillBtn').addEventListener('click', () => {
                    if (this.activeCell) {
                        this.fillImageToCell(this.activeCell);
                        this.updateControlsForCell(this.activeCell);
                    }
                });

                document.getElementById('centerBtn').addEventListener('click', () => {
                    if (this.activeCell) {
                        this.centerImage(this.activeCell);
                    }
                });

                document.getElementById('newImageBtn').addEventListener('click', () => {
                    if (this.activeCell) {
                        // Clear current image
                        const container = this.activeCell.querySelector('.image-container');
                        const img = container.querySelector('img');
                        if (img) {
                            img.remove();
                        }
                        
                        // Add loading indicator
                        const loadingIndicator = document.createElement('div');
                        loadingIndicator.className = 'loading-indicator';
                        loadingIndicator.textContent = 'Loading...';
                        container.appendChild(loadingIndicator);
                        
                        // Load new image
                        const randomId = Math.floor(Math.random() * 1000) + 1000;
                        this.loadImageForCell(this.activeCell, randomId);
                    }
                });

                // Window resize handler
                window.addEventListener('resize', () => {
                    // Refit all images on window resize
                    setTimeout(() => {
                        this.currentImageData.forEach((data, cell) => {
                            this.fitImageToCell(cell);
                        });
                    }, 100);
                });
            }
        }

        // Initialize the photo album when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new PhotoAlbum();
        });
    </script>
</body>
</html>