<!-- great, however the cropper doesn't adjust when we drag & drop the gutters. It remains on it's initial size on page load. 
Either make it adapt dynamically for all images, or on double click of an image, instantiate a cropper instance for the fixed size the cell has at that time -->
<!-- tried to redo it but without success -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable Photo Album</title>
    
    <!-- Bootstrap 5.3 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">

    <style>
        body {
            margin: 0;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            overflow: hidden;
        }

        .album {
            width: 100%;
            max-width: 1800px;
            background-color: #333;
        }

        .page {
            aspect-ratio: 35 / 29;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            padding: 0;
            overflow: hidden;
        }

        .page-row {
            display: flex;
            flex-direction: row;
            width: 100%;
            overflow: hidden;
        }
        
        .cell {
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .cell:hover {
            box-shadow: inset 0 0 0 2px #007bff;
        }

        .cell.active {
            box-shadow: inset 0 0 0 3px #007bff;
        }

        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .gutter {
            background-color: #ffffff;
            background-repeat: no-repeat;
            background-position: center;
        }

        .gutter.gutter-vertical {
            cursor: row-resize;
        }

        .gutter.gutter-horizontal {
            cursor: col-resize;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            color: white;
            display: none;
            z-index: 1000;
            min-width: 200px;
        }

        .controls.show {
            display: block;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            color: #ccc;
        }

        .zoom-slider {
            width: 100%;
            margin: 5px 0;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }

        /* Override Cropper.js styles to fit our cells */
        .cropper-container {
            width: 100% !important;
            height: 100% !important;
        }

        .cropper-canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .cropper-view-box {
            outline: none !important;
        }

        .cropper-face {
            background: transparent !important;
        }
    </style>
</head>
<body>

    <div class="album-container container-fluid">
        <div class="row album g-4 justify-content-center">

            <!-- Left Page -->
            <div class="col-sm-6">
                <div class="page" id="page-left">
                    <div class="page-row" id="left-row-top">
                        <div class="cell" data-id="1">
                            <img src="https://picsum.photos/seed/1/800/600" alt="Image 1">
                        </div>
                        <div class="cell" data-id="2">
                            <img src="https://picsum.photos/seed/2/800/600" alt="Image 2">
                        </div>
                        <div class="cell" data-id="3">
                            <img src="https://picsum.photos/seed/3/800/600" alt="Image 3">
                        </div>
                    </div>
                    <div class="page-row" id="left-row-bottom">
                        <div class="cell" data-id="4">
                            <img src="https://picsum.photos/seed/4/800/600" alt="Image 4">
                        </div>
                        <div class="cell" data-id="5">
                            <img src="https://picsum.photos/seed/5/800/600" alt="Image 5">
                        </div>
                        <div class="cell" data-id="6">
                            <img src="https://picsum.photos/seed/6/800/600" alt="Image 6">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Page -->
            <div class="col-sm-6">
                 <div class="page" id="page-right">
                    <div class="page-row" id="right-row-top">
                        <div class="cell" data-id="7">
                            <img src="https://picsum.photos/seed/7/800/600" alt="Image 7">
                        </div>
                        <div class="cell" data-id="8">
                            <img src="https://picsum.photos/seed/8/800/600" alt="Image 8">
                        </div>
                        <div class="cell" data-id="9">
                            <img src="https://picsum.photos/seed/9/800/600" alt="Image 9">
                        </div>
                    </div>
                    <div class="page-row" id="right-row-bottom">
                        <div class="cell" data-id="10">
                            <img src="https://picsum.photos/seed/10/800/600" alt="Image 10">
                        </div>
                        <div class="cell" data-id="11">
                            <img src="https://picsum.photos/seed/11/800/600" alt="Image 11">
                        </div>
                        <div class="cell" data-id="12">
                            <img src="https://picsum.photos/seed/12/800/600" alt="Image 12">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Controls Panel -->
    <div class="controls" id="controls">
        <div class="control-group">
            <label>Zoom Level</label>
            <input type="range" class="zoom-slider" id="zoomSlider" min="0" max="1" step="0.01" value="0">
            <small id="zoomValue">100%</small>
        </div>
        <div class="control-group">
            <button class="btn btn-warning btn-sm w-100" id="newImageBtn">New Image</button>
        </div>
    </div>

    <!-- Split.js CDN -->
    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
    
    <!-- Cropper.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

    <script>
        class PhotoAlbum {
            constructor() {
                this.activeCell = null;
                this.activeCropper = null;
                this.croppers = new Map();
                
                this.init();
            }

            init() {
                this.setupSplitters();
                this.setupEventListeners();
                this.initializeCroppers();
            }

            setupSplitters() {
                const GUTTER_SIZE = 12;
                
                // Page splits (rows)
                Split(['#left-row-top', '#left-row-bottom'], {
                    direction: 'vertical',
                    sizes: [50, 50],
                    gutterSize: GUTTER_SIZE,
                    minSize: 100,
                });

                Split(['#right-row-top', '#right-row-bottom'], {
                    direction: 'vertical',
                    sizes: [50, 50],
                    gutterSize: GUTTER_SIZE,
                    minSize: 100,
                });

                // Cell splits (columns)
                Split(document.querySelectorAll('#left-row-top .cell'), {
                    direction: 'horizontal',
                    sizes: [33.33, 33.34, 33.33],
                    gutterSize: GUTTER_SIZE,
                    minSize: 80,
                });

                Split(document.querySelectorAll('#left-row-bottom .cell'), {
                    direction: 'horizontal',
                    sizes: [33.33, 33.34, 33.33],
                    gutterSize: GUTTER_SIZE,
                    minSize: 80,
                });

                Split(document.querySelectorAll('#right-row-top .cell'), {
                    direction: 'horizontal',
                    sizes: [33.33, 33.34, 33.33],
                    gutterSize: GUTTER_SIZE,
                    minSize: 80,
                });

                Split(document.querySelectorAll('#right-row-bottom .cell'), {
                    direction: 'horizontal',
                    sizes: [33.33, 33.34, 33.33],
                    gutterSize: GUTTER_SIZE,
                    minSize: 80,
                });
            }

            initializeCroppers() {
                document.querySelectorAll('.cell img').forEach(img => {
                    const cropper = new Cropper(img, {
                        viewMode: 3, // Restrict crop box to not exceed the size of the canvas
                        dragMode: 'move', // Only allow moving, not drawing new crop box
                        aspectRatio: NaN, // Free aspect ratio
                        autoCropArea: 1, // 100% crop area
                        restore: false,
                        guides: false,
                        center: false,
                        highlight: false,
                        cropBoxMovable: false,
                        cropBoxResizable: false,
                        toggleDragModeOnDblclick: false,
                        ready: () => {
                            // Auto-zoom to fill the container
                            cropper.zoomTo(1);
                        }
                    });
                    
                    this.croppers.set(img.closest('.cell'), cropper);
                });
            }

            setActiveCell(cell) {
                // Deactivate all cells
                document.querySelectorAll('.cell').forEach(c => c.classList.remove('active'));
                
                this.activeCell = cell;
                this.activeCropper = this.croppers.get(cell);
                
                if (cell) {
                    cell.classList.add('active');
                    this.showControls();
                    this.updateControlsForCell();
                } else {
                    this.hideControls();
                    this.activeCropper = null;
                }
            }

            showControls() {
                document.getElementById('controls').classList.add('show');
            }

            hideControls() {
                document.getElementById('controls').classList.remove('show');
            }

            updateControlsForCell() {
                if (!this.activeCropper) return;
                
                const data = this.activeCropper.getImageData();
                const containerData = this.activeCropper.getContainerData();
                
                // Calculate zoom level (0 = fit, 1 = maximum zoom)
                const scaleX = containerData.width / data.naturalWidth;
                const scaleY = containerData.height / data.naturalHeight;
                const minScale = Math.max(scaleX, scaleY); // Scale to fill
                const currentScale = data.scaleX;
                
                const zoomLevel = Math.max(0, (currentScale - minScale) / (minScale * 4)); // Max 5x zoom
                
                document.getElementById('zoomSlider').value = zoomLevel;
                document.getElementById('zoomValue').textContent = `${Math.round((currentScale / minScale) * 100)}%`;
            }

            setupEventListeners() {
                // Cell click handlers
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.setActiveCell(cell);
                    });
                });

                // Click outside to deselect
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.cell') && !e.target.closest('.controls')) {
                        this.setActiveCell(null);
                    }
                });

                // Zoom slider
                document.getElementById('zoomSlider').addEventListener('input', (e) => {
                    if (!this.activeCropper) return;
                    
                    const data = this.activeCropper.getImageData();
                    const containerData = this.activeCropper.getContainerData();
                    
                    const scaleX = containerData.width / data.naturalWidth;
                    const scaleY = containerData.height / data.naturalHeight;
                    const minScale = Math.max(scaleX, scaleY);
                    
                    const zoomLevel = parseFloat(e.target.value);
                    const targetScale = minScale + (zoomLevel * minScale * 4); // Up to 5x zoom
                    
                    this.activeCropper.zoomTo(targetScale / data.scaleX);
                    
                    document.getElementById('zoomValue').textContent = `${Math.round((targetScale / minScale) * 100)}%`;
                });

                // New image button
                document.getElementById('newImageBtn').addEventListener('click', () => {
                    if (!this.activeCell) return;
                    
                    const img = this.activeCell.querySelector('img');
                    const cropper = this.croppers.get(this.activeCell);
                    
                    if (cropper) {
                        cropper.destroy();
                    }
                    
                    const randomId = Math.floor(Math.random() * 1000) + 1000;
                    img.src = `https://picsum.photos/seed/${randomId}/800/600`;
                    
                    img.onload = () => {
                        const newCropper = new Cropper(img, {
                            viewMode: 3,
                            dragMode: 'move',
                            aspectRatio: NaN,
                            autoCropArea: 1,
                            restore: false,
                            guides: false,
                            center: false,
                            highlight: false,
                            cropBoxMovable: false,
                            cropBoxResizable: false,
                            toggleDragModeOnDblclick: false,
                            ready: () => {
                                newCropper.zoomTo(1);
                            }
                        });
                        
                        this.croppers.set(this.activeCell, newCropper);
                        this.activeCropper = newCropper;
                        this.updateControlsForCell();
                    };
                });

                // Handle window resize
                window.addEventListener('resize', () => {
                    setTimeout(() => {
                        this.croppers.forEach(cropper => {
                            cropper.resize();
                        });
                    }, 100);
                });
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new PhotoAlbum();
        });
    </script>
</body>
</html>