<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Grid</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --gutter-size: 10px;
            --bg-color: #f8f9fa;
        }
        
        body {
            background-color: #e9ecef;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }

        .spread-container {
            width: 100%;
            max-width: 1600px; /* Reasonable max width */
            display: flex;
            gap: 20px; /* Space between pages, distinct from gutters inside */
            justify-content: center;
            aspect-ratio: 70 / 29; /* (35 * 2) / 29 */
        }

        .page {
            flex: 1;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: 100%;
            display: grid;
            /* Initial row setup: row1 gutter row2 */
            grid-template-rows: 1fr var(--gutter-size) 1fr; 
            padding: var(--gutter-size); /* Outer padding if desired, or just keep edges flush */
            overflow: hidden;
            position: relative;
        }

        /* The row item itself */
        .grid-row {
            display: grid;
            /* Initial col setup: col1 gutter col2 gutter col3 */
            grid-template-columns: 1fr var(--gutter-size) 1fr var(--gutter-size) 1fr;
            height: 100%;
            width: 100%;
            min-height: 0; /* Fix flex/grid overflow issues */
        }

        .cell {
            background-color: #ddd;
            overflow: hidden;
            position: relative;
            width: 100%;
            height: 100%;
        }

        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Gutters */
        .gutter-h {
            cursor: row-resize;
            background-color: white; /* Visual white space */
            z-index: 10;
        }

        .gutter-v {
            cursor: col-resize;
            background-color: white;
            z-index: 10;
        }

        /* Hover states for better affordance */
        .gutter-h:hover, .gutter-v:hover {
            background-color: #f0f0f0;
        }

        .gutter-active {
            background-color: #0d6efd !important;
        }

    </style>
</head>
<body>

<div class="spread-container" id="app">
    <!-- Left Page -->
    <div class="page" id="page-left">
        <div class="grid-row" id="p1-r1">
            <div class="cell"><img src="https://picsum.photos/400/300?random=1" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="0" data-next="2"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=2" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="2" data-next="4"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=3" alt=""></div>
        </div>
        
        <div class="gutter-h" data-type="row" data-prev="0" data-next="2"></div>
        
        <div class="grid-row" id="p1-r2">
            <div class="cell"><img src="https://picsum.photos/400/300?random=4" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="0" data-next="2"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=5" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="2" data-next="4"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=6" alt=""></div>
        </div>
    </div>

    <!-- Right Page -->
    <div class="page" id="page-right">
        <div class="grid-row" id="p2-r1">
            <div class="cell"><img src="https://picsum.photos/400/300?random=7" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="0" data-next="2"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=8" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="2" data-next="4"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=9" alt=""></div>
        </div>
        
        <div class="gutter-h" data-type="row" data-prev="0" data-next="2"></div>
        
        <div class="grid-row" id="p2-r2">
            <div class="cell"><img src="https://picsum.photos/400/300?random=10" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="0" data-next="2"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=11" alt=""></div>
            <div class="gutter-v" data-type="col" data-prev="2" data-next="4"></div>
            <div class="cell"><img src="https://picsum.photos/400/300?random=12" alt=""></div>
        </div>
    </div>
</div>

<script>
    // State for dragging
    let isDragging = false;
    let currentGutter = null;
    let startPos = 0;
    let startPrevSize = 0;
    let startNextSize = 0;
    let trackValues = []; // Array of pixel values or percentages
    let containerSize = 0;

    const gutterSize = 10; // Must match CSS

    document.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains('gutter-v') || e.target.classList.contains('gutter-h')) {
            e.preventDefault();
            isDragging = true;
            currentGutter = e.target;
            currentGutter.classList.add('gutter-active');
            
            const isRow = currentGutter.classList.contains('gutter-h');
            const parent = currentGutter.parentElement;
            
            // Get computed grid tracks
            const computedStyle = window.getComputedStyle(parent);
            const tracks = isRow 
                ? computedStyle.gridTemplateRows.split(' ') 
                : computedStyle.gridTemplateColumns.split(' ');

            // Parse tracks to pixels
            trackValues = tracks.map(t => parseFloat(t));
            
            // Store indices
            const prevIndex = parseInt(currentGutter.dataset.prev);
            const nextIndex = parseInt(currentGutter.dataset.next);
            
            startPrevSize = trackValues[prevIndex];
            startNextSize = trackValues[nextIndex];
            
            startPos = isRow ? e.clientY : e.clientX;
            containerSize = isRow ? parent.clientHeight : parent.clientWidth;
        }
    });

    document.addEventListener('mousemove', (e) => {
        if (!isDragging || !currentGutter) return;
        
        e.preventDefault();
        
        const isRow = currentGutter.classList.contains('gutter-h');
        const currentPos = isRow ? e.clientY : e.clientX;
        const delta = currentPos - startPos;
        
        // Calculate new sizes
        let newPrevSize = startPrevSize + delta;
        let newNextSize = startNextSize - delta;
        
        // Min size constraint (e.g., 20px)
        const minSize = 20;
        if (newPrevSize < minSize) {
            newPrevSize = minSize;
            newNextSize = startPrevSize + startNextSize - minSize;
        }
        if (newNextSize < minSize) {
            newNextSize = minSize;
            newPrevSize = startPrevSize + startNextSize - minSize;
        }

        // Apply new sizes as percentages to maintain fluid layout
        // We need to convert ALL tracks to percentages or fr, 
        // but mixing px (gutter) and fr/percent is tricky if we update just two.
        // Best approach: Convert the two changed tracks to 'fr' relative to total available space? 
        // Or just use 'px' temporarily? 
        // Requirement: "fluidly scale". Fixed pixels won't scale.
        // So we must convert to Percentages or FR.
        
        // Let's reconstruct the grid-template string
        const parent = currentGutter.parentElement;
        const prevIndex = parseInt(currentGutter.dataset.prev);
        const nextIndex = parseInt(currentGutter.dataset.next);

        // Update the specific tracks in our values array
        // We use the pixel values calculated to determine the ratio
        
        // To be truly fluid, we should probably set the template to use `fr` units based on the pixel distribution.
        // Or percentages.
        
        // Strategy: Convert all content tracks to `fr` based on current pixel sizes.
        // Gutter tracks remain fixed px (or however they are defined).
        
        // Update the tracked values for the active interaction
        trackValues[prevIndex] = newPrevSize;
        trackValues[nextIndex] = newNextSize;
        
        let newTemplate = '';
        trackValues.forEach((val, idx) => {
            // Check if it's a gutter track (odd indices in our 0-based layout: 0, G, 2, G, 4...)
            // Actually my HTML structure has divs for gutters.
            // In CSS Grid, the gutter elements are just items in the grid flow if we don't name areas.
            // Wait, my CSS: 
            // Row: grid-template-columns: 1fr var(--gutter-size) 1fr ...
            // The gutter DIVs are positioned in the grid.
            // But `grid-template-columns` defines the tracks.
            // The gutter DIV needs to sit in the gutter track.
            
            // Current CSS assumes the gutter DIVs are flow content? 
            // No, default grid placement puts them in cells.
            // I need to make sure the gutter divs are placed correctly?
            // With `display: grid`, items fill cells.
            // My structure: cell, gutter-v, cell, gutter-v, cell.
            // That's 5 items.
            // Grid columns: 1fr 10px 1fr 10px 1fr.
            // So item 1 (cell) goes to track 1.
            // Item 2 (gutter-v) goes to track 2.
            // Perfect.
            
            // So indices 1 and 3 are gutters (fixed 10px).
            // Indices 0, 2, 4 are content.
            
            if (idx === prevIndex || idx === nextIndex) {
                 // Convert to fr
                 newTemplate += `${val}fr `;
            } else if ((idx % 2) !== 0) {
                 // Gutter tracks - keep as var or px
                 newTemplate += `var(--gutter-size) `;
            } else {
                 // Other content tracks - keep their pixel value but converted to fr
                 newTemplate += `${val}fr `;
            }
        });
        
        if (isRow) {
             parent.style.gridTemplateRows = newTemplate;
        } else {
             parent.style.gridTemplateColumns = newTemplate;
        }
    });

    document.addEventListener('mouseup', () => {
        if (isDragging && currentGutter) {
            currentGutter.classList.remove('gutter-active');
            isDragging = false;
            currentGutter = null;
        }
    });
</script>
</body>
</html>

